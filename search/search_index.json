{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"UniFi Monitor","text":"<p>Real-time network monitoring dashboard for UniFi networks. One container, zero external dependencies beyond your gateway.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Live dashboard -- health score, connected clients, WAN latency, device status, active alarms</li> <li>WebSocket updates -- instant push when poller completes (no polling lag)</li> <li>Per-client drill-down -- 24h signal strength and satisfaction charts per client</li> <li>Alert notifications -- configurable thresholds with webhook delivery (Discord, Slack, ntfy)</li> <li>NetFlow/IPFIX visualization -- top talkers, bandwidth over time, port/protocol breakdown</li> <li>DNS traffic analysis -- top DNS clients and servers from NetFlow data (port 53/853)</li> <li>Multi-site support -- monitor multiple UniFi sites with site selector dropdown</li> <li>Historical comparison -- compare latency, bandwidth, or client count vs last week</li> <li>Data export -- download client or WAN data as CSV or JSON</li> <li>Dark/light theme -- persisted in browser</li> <li>Zero dependencies -- no Grafana, no InfluxDB, no external database. SQLite + one container.</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#docker-recommended","title":"Docker (recommended)","text":"<pre><code>git clone https://github.com/Matt-Bloise/unifi-monitor.git\ncd unifi-monitor\ncp .env.example .env\n# Edit .env: set UNIFI_HOST, UNIFI_USERNAME, UNIFI_PASSWORD\ndocker compose up -d\n</code></pre> <p>Dashboard at http://localhost:8080.</p>"},{"location":"#local","title":"Local","text":"<pre><code>pip install -e \".[dev,netflow]\"\ncp .env.example .env\n# Edit .env\npython -m unifi_monitor\n</code></pre>"},{"location":"#pages","title":"Pages","text":"Page Description Architecture System design, data flow, SQLite schema, module overview Configuration Environment variables, <code>.env</code> reference, multi-site setup API Reference All 19 REST endpoints + WebSocket protocol NetFlow NetFlow/IPFIX setup, DNS traffic analysis, gateway configuration Alerts Default rules, webhook payload format, custom rules, cooldowns Deployment Docker compose, systemd, reverse proxy, healthcheck"},{"location":"#compatibility","title":"Compatibility","text":"<p>Works with any UniFi OS gateway: UCG-Max, UCG-Ultra, UDM, UDM-Pro, UDM-SE, UDR, Cloud Key Gen2+.</p> <p>Requires local network access to the gateway (not cloud-only).</p>"},{"location":"alerts/","title":"Alerts","text":"<p>UniFi Monitor evaluates alert rules after each poller cycle and sends webhook notifications when thresholds are exceeded.</p>"},{"location":"alerts/#setup","title":"Setup","text":"<p>Set <code>ALERT_WEBHOOK_URL</code> to enable:</p> <pre><code>ALERT_WEBHOOK_URL=https://discord.com/api/webhooks/...\n</code></pre> <p>Works with Discord webhooks, Slack incoming webhooks, ntfy, or any HTTP endpoint that accepts JSON POST.</p>"},{"location":"alerts/#default-rules","title":"Default Rules","text":"Metric Operator Threshold Message Cooldown <code>wan_status</code> <code>ne</code> (not equal) <code>ok</code> \"WAN is {value}\" 300s <code>health_score</code> <code>lt</code> (less than) <code>50</code> \"Health score dropped to {value}\" 300s <code>device_offline</code> <code>gt</code> (greater than) <code>0</code> \"{value} device(s) offline\" 300s <code>wan_latency</code> <code>gt</code> (greater than) <code>100</code> \"WAN latency {value}ms\" 600s"},{"location":"alerts/#webhook-payload","title":"Webhook Payload","text":"<p>When one or more rules fire, a single POST is sent:</p> <pre><code>{\n  \"alerts\": [\n    {\n      \"rule\": \"wan_latency gt 100\",\n      \"value\": 125.3,\n      \"message\": \"WAN latency 125.3ms\",\n      \"ts\": 1234567890\n    }\n  ],\n  \"source\": \"unifi-monitor\",\n  \"timestamp\": 1234567890\n}\n</code></pre> <p>Multiple alerts can fire in the same cycle and are batched into one webhook call.</p>"},{"location":"alerts/#cooldowns","title":"Cooldowns","text":"<p>Each rule has an independent cooldown timer. After firing, the rule won't fire again until the cooldown expires. This prevents notification spam during sustained issues.</p> Variable Default Min Description <code>ALERT_COOLDOWN</code> <code>300</code> <code>30</code> Seconds between repeated alerts per rule <p>The default cooldown is 5 minutes. The <code>wan_latency</code> rule uses a 10-minute cooldown to reduce noise from transient latency spikes.</p>"},{"location":"alerts/#metric-extraction","title":"Metric Extraction","text":"<p>Metrics are extracted from the poller snapshot:</p> Metric Source Type <code>wan_status</code> WAN status string string <code>health_score</code> Calculated weighted score integer (0-100) <code>device_offline</code> Count of devices with state != 1 integer <code>wan_latency</code> Gateway-reported WAN latency float (ms)"},{"location":"alerts/#custom-rules","title":"Custom Rules","text":"<p>Alert rules are defined in <code>alerts.py</code>. To add a custom rule, add an entry to the <code>DEFAULT_RULES</code> list:</p> <pre><code>{\n    \"metric\": \"mem_pct\",\n    \"op\": \"gt\",\n    \"threshold\": 95,\n    \"message\": \"Gateway memory at {value}%\",\n    \"cooldown\": 600,\n}\n</code></pre> <p>Supported operators: <code>gt</code>, <code>lt</code>, <code>ge</code>, <code>le</code>, <code>eq</code>, <code>ne</code>.</p>"},{"location":"api-reference/","title":"API Reference","text":"<p>All endpoints are served at <code>http://&lt;host&gt;:8080</code>. When Basic Auth is enabled, all endpoints except <code>/api/health</code> require authentication.</p> <p>All endpoints accept an optional <code>?site=</code> query parameter for multi-site filtering.</p>"},{"location":"api-reference/#health","title":"Health","text":""},{"location":"api-reference/#get-apihealth","title":"<code>GET /api/health</code>","text":"<p>Health check endpoint. Bypasses authentication for Docker healthchecks.</p> <p>Response:</p> <pre><code>{\n  \"status\": \"ok\",\n  \"uptime_s\": 3600.5,\n  \"last_write_ts\": 1234567890.123,\n  \"db_size_bytes\": 2310144\n}\n</code></pre>"},{"location":"api-reference/#authentication","title":"Authentication","text":""},{"location":"api-reference/#get-apiauthtoken","title":"<code>GET /api/auth/token</code>","text":"<p>Returns a WebSocket authentication token (hour-based SHA-256 hash). Only available when Basic Auth is enabled.</p> <p>Response:</p> <pre><code>{\n  \"token\": \"a1b2c3d4...\"\n}\n</code></pre>"},{"location":"api-reference/#sites","title":"Sites","text":""},{"location":"api-reference/#get-apisites","title":"<code>GET /api/sites</code>","text":"<p>List configured sites and the default site.</p> <p>Response:</p> <pre><code>{\n  \"sites\": [\"default\", \"office\"],\n  \"default\": \"default\"\n}\n</code></pre>"},{"location":"api-reference/#dashboard","title":"Dashboard","text":""},{"location":"api-reference/#get-apioverview","title":"<code>GET /api/overview</code>","text":"<p>Dashboard summary with health score, WAN status, client/device counts, and alarms.</p> <p>Response:</p> <pre><code>{\n  \"health_score\": 92,\n  \"wan\": {\n    \"status\": \"ok\",\n    \"latency_ms\": 12.5,\n    \"wan_ip\": \"45.47.143.169\",\n    \"cpu_pct\": 30.2,\n    \"mem_pct\": 80.1\n  },\n  \"client_count\": 24,\n  \"device_count\": 2,\n  \"alarm_count\": 0,\n  \"ts\": 1234567890.123\n}\n</code></pre> <p>Health score is weighted: WAN status (40%) + device health (30%) + alarm severity (30%).</p>"},{"location":"api-reference/#clients","title":"Clients","text":""},{"location":"api-reference/#get-apiclients","title":"<code>GET /api/clients</code>","text":"<p>Connected clients, paginated.</p> Param Default Description <code>offset</code> <code>0</code> Pagination offset <code>limit</code> <code>50</code> Page size <p>Response:</p> <pre><code>{\n  \"clients\": [\n    {\n      \"mac\": \"aa:bb:cc:dd:ee:ff\",\n      \"hostname\": \"MacBook-Pro\",\n      \"ip\": \"192.168.1.100\",\n      \"is_wired\": false,\n      \"ssid\": \"__5G__\",\n      \"signal_dbm\": -45,\n      \"satisfaction\": 98,\n      \"channel\": 100,\n      \"radio\": \"na\",\n      \"tx_bytes\": 1234567,\n      \"rx_bytes\": 7654321,\n      \"tx_rate\": 1200.0,\n      \"rx_rate\": 1200.0\n    }\n  ],\n  \"total\": 24,\n  \"ts\": 1234567890.123\n}\n</code></pre>"},{"location":"api-reference/#get-apiclientsmachistory","title":"<code>GET /api/clients/{mac}/history</code>","text":"<p>Signal strength and satisfaction history for a specific client.</p> Param Default Description <code>hours</code> <code>24</code> Lookback window <p>Response:</p> <pre><code>{\n  \"mac\": \"aa:bb:cc:dd:ee:ff\",\n  \"history\": [\n    {\"ts\": 1234567890, \"signal_dbm\": -45, \"satisfaction\": 98}\n  ]\n}\n</code></pre>"},{"location":"api-reference/#devices","title":"Devices","text":""},{"location":"api-reference/#get-apidevices","title":"<code>GET /api/devices</code>","text":"<p>Adopted devices with stats.</p> <p>Response:</p> <pre><code>{\n  \"devices\": [\n    {\n      \"mac\": \"0c:ea:14:39:e8:31\",\n      \"name\": \"UCG-Max\",\n      \"model\": \"UCG-Max\",\n      \"ip\": \"192.168.1.1\",\n      \"state\": 1,\n      \"cpu_pct\": 30.2,\n      \"mem_pct\": 80.1,\n      \"num_clients\": 24,\n      \"satisfaction\": 95,\n      \"tx_bytes_r\": 50000.0,\n      \"rx_bytes_r\": 200000.0\n    }\n  ],\n  \"ts\": 1234567890.123\n}\n</code></pre>"},{"location":"api-reference/#wan","title":"WAN","text":""},{"location":"api-reference/#get-apiwanhistory","title":"<code>GET /api/wan/history</code>","text":"<p>WAN latency and status history.</p> Param Default Description <code>hours</code> <code>24</code> Lookback window <p>Response:</p> <pre><code>{\n  \"history\": [\n    {\n      \"ts\": 1234567890,\n      \"status\": \"ok\",\n      \"latency_ms\": 12.5,\n      \"download_bps\": 600000000,\n      \"upload_bps\": 50000000,\n      \"wan_ip\": \"45.47.143.169\",\n      \"cpu_pct\": 30.2,\n      \"mem_pct\": 80.1\n    }\n  ]\n}\n</code></pre>"},{"location":"api-reference/#traffic-netflow","title":"Traffic (NetFlow)","text":"<p>Requires NetFlow/IPFIX to be enabled and sending data.</p>"},{"location":"api-reference/#get-apitraffictop-talkers","title":"<code>GET /api/traffic/top-talkers</code>","text":"<p>Top source IPs by total bytes.</p> Param Default Description <code>hours</code> <code>1</code> Lookback window <code>limit</code> <code>20</code> Max results"},{"location":"api-reference/#get-apitraffictop-destinations","title":"<code>GET /api/traffic/top-destinations</code>","text":"<p>Top destination IPs by total bytes. Same params as top-talkers.</p>"},{"location":"api-reference/#get-apitraffictop-ports","title":"<code>GET /api/traffic/top-ports</code>","text":"<p>Top ports by total bytes. Same params as top-talkers.</p>"},{"location":"api-reference/#get-apitrafficbandwidth","title":"<code>GET /api/traffic/bandwidth</code>","text":"<p>Bandwidth timeseries, bucketed.</p> Param Default Description <code>hours</code> <code>24</code> Lookback window <code>bucket_minutes</code> <code>5</code> Bucket size in minutes <p>Response:</p> <pre><code>{\n  \"buckets\": [\n    {\"ts\": 1234567890, \"bytes\": 50000000}\n  ]\n}\n</code></pre>"},{"location":"api-reference/#get-apitrafficdns-queries","title":"<code>GET /api/traffic/dns-queries</code>","text":"<p>DNS query aggregates (per-client-per-server).</p> Param Default Description <code>hours</code> <code>1</code> Lookback window <code>limit</code> <code>100</code> Max results"},{"location":"api-reference/#get-apitrafficdns-top-clients","title":"<code>GET /api/traffic/dns-top-clients</code>","text":"<p>Top DNS-querying clients by total bytes.</p> Param Default Description <code>hours</code> <code>1</code> Lookback window <code>limit</code> <code>20</code> Max results"},{"location":"api-reference/#get-apitrafficdns-top-servers","title":"<code>GET /api/traffic/dns-top-servers</code>","text":"<p>Top DNS servers by total bytes. Same params as dns-top-clients.</p>"},{"location":"api-reference/#comparison","title":"Comparison","text":""},{"location":"api-reference/#get-apicompare","title":"<code>GET /api/compare</code>","text":"<p>Historical comparison (current period vs offset period).</p> Param Default Description <code>metric</code> (required) <code>latency</code>, <code>bandwidth</code>, or <code>client_count</code> <code>hours</code> <code>24</code> Window size <code>offset_hours</code> <code>168</code> Offset to comparison period (default: 1 week) <p>Response:</p> <pre><code>{\n  \"current\": [{\"ts\": 1234567890, \"value\": 12.5}],\n  \"previous\": [{\"ts\": 1234567890, \"value\": 14.2}]\n}\n</code></pre>"},{"location":"api-reference/#alarms","title":"Alarms","text":""},{"location":"api-reference/#get-apialarms","title":"<code>GET /api/alarms</code>","text":"<p>Active (non-archived) alarms from the UniFi gateway.</p> <p>Response:</p> <pre><code>{\n  \"alarms\": [\n    {\n      \"alarm_id\": \"abc123\",\n      \"type\": \"EVT_GW_WANTransition\",\n      \"message\": \"WAN transitioned\",\n      \"device_name\": \"UCG-Max\",\n      \"ts\": 1234567890\n    }\n  ]\n}\n</code></pre>"},{"location":"api-reference/#export","title":"Export","text":""},{"location":"api-reference/#get-apiexportclients","title":"<code>GET /api/export/clients</code>","text":"<p>Export client data as JSON or CSV.</p> Param Default Description <code>hours</code> <code>24</code> Lookback window <code>format</code> <code>json</code> <code>json</code> or <code>csv</code> <code>limit</code> <code>10000</code> Max rows"},{"location":"api-reference/#get-apiexportwan","title":"<code>GET /api/export/wan</code>","text":"<p>Export WAN metrics as JSON or CSV. Same params as export/clients.</p>"},{"location":"api-reference/#websocket","title":"WebSocket","text":""},{"location":"api-reference/#ws-apiws","title":"<code>WS /api/ws</code>","text":"<p>Live dashboard updates. When the poller completes a cycle, it broadcasts the latest snapshot to all connected clients.</p> <p>Connection:</p> <pre><code>ws://localhost:8080/api/ws\n</code></pre> <p>When Basic Auth is enabled, include the token:</p> <pre><code>ws://localhost:8080/api/ws?token=&lt;token_from_auth_endpoint&gt;\n</code></pre> <p>Messages (server -&gt; client):</p> <p>JSON objects matching the <code>/api/overview</code> response shape, sent after each poll cycle.</p> <p>Behavior:</p> <ul> <li>Server sends data immediately after each poller cycle</li> <li>No client-to-server messages expected</li> <li>Dead connections are automatically cleaned up</li> <li>Dashboard JS auto-reconnects with exponential backoff (1s -&gt; 30s max)</li> <li>Falls back to REST polling after 3 consecutive WebSocket failures</li> </ul>"},{"location":"architecture/","title":"Architecture","text":""},{"location":"architecture/#system-overview","title":"System Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            unifi-monitor                 \u2502\n\u2502                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502  Poller   \u2502\u2500\u2500&gt;\u2502   SQLite DB   \u2502       \u2502\n\u2502  \u2502(UniFi API)\u2502    \u2502  (WAL mode)   \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502       \u2502                 \u2502                \u2502\n\u2502       \u251c\u2500&gt; WS Broadcast  \u2502                \u2502\n\u2502       \u2514\u2500&gt; Alert Engine  \u2502                \u2502\n\u2502                         \u2502                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502                \u2502\n\u2502  \u2502 NetFlow  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502  \u2502(UDP 2055)\u2502                            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502                  \u2502   FastAPI     \u2502       \u2502\n\u2502                  \u2502 REST + WS     \u2502\u2500\u2500\u2500\u2500 :8080\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#data-flow","title":"Data Flow","text":"<ol> <li>Poller (<code>poller.py</code>) queries the UniFi gateway API every <code>POLL_INTERVAL</code> seconds</li> <li>Responses are parsed into typed dicts and written to SQLite (<code>db.py</code>) with WAL mode</li> <li>After each poll, the poller broadcasts a snapshot to all WebSocket clients (<code>ws.py</code>)</li> <li>The poller evaluates alert rules (<code>alerts.py</code>) against the latest snapshot</li> <li>If any rule fires (and is not in cooldown), a webhook POST is sent to <code>ALERT_WEBHOOK_URL</code></li> <li>NetFlow collector (<code>netflow/collector.py</code>) listens on UDP 2055 for IPFIX/NetFlow packets</li> <li>Flow records are parsed (<code>netflow/parser.py</code>) and batch-written to SQLite every 10 seconds</li> <li>FastAPI (<code>app.py</code>, <code>api/routes.py</code>) serves the REST API, WebSocket endpoint, and static dashboard</li> </ol>"},{"location":"architecture/#modules","title":"Modules","text":"Module Lines Purpose <code>app.py</code> 176 FastAPI application with lifespan, auth middleware, static file serving <code>config.py</code> 78 Environment variable loading with bounds validation <code>db.py</code> 527 SQLite storage: schema, CRUD, retention cleanup, historical comparison <code>poller.py</code> 278 Periodic UniFi API polling, per-endpoint error isolation, snapshot building <code>unifi_client.py</code> 124 UniFi OS API wrapper: session reuse, CSRF, 401 auto-retry <code>ws.py</code> 39 WebSocket broadcast hub (in-memory connection set) <code>alerts.py</code> 138 Alert rule evaluation + webhook notification with per-rule cooldowns <code>api/routes.py</code> 434 18 REST endpoints + 1 WebSocket, dependency injection via <code>app.state</code> <code>netflow/parser.py</code> 133 IPFIX v10 + NetFlow v5/v9 parser with template cache <code>netflow/collector.py</code> 85 Async UDP listener, thread-safe batch writes"},{"location":"architecture/#sqlite-schema","title":"SQLite Schema","text":"<p>All tables include a <code>site</code> column (default <code>'default'</code>) for multi-site support. WAL mode enables concurrent reads during writes.</p>"},{"location":"architecture/#wan_metrics","title":"wan_metrics","text":"Column Type Description ts REAL Unix timestamp status TEXT <code>\"ok\"</code> or error string latency_ms REAL Gateway-reported WAN latency download_bps REAL Download speed in bits/sec upload_bps REAL Upload speed in bits/sec wan_ip TEXT Public IP address cpu_pct REAL Gateway CPU percentage mem_pct REAL Gateway memory percentage site TEXT Site identifier"},{"location":"architecture/#devices","title":"devices","text":"Column Type Description ts REAL Unix timestamp mac TEXT Device MAC address name TEXT Device name model TEXT Hardware model ip TEXT Device IP state INTEGER 1 = online cpu_pct REAL CPU percentage mem_pct REAL Memory percentage num_clients INTEGER Connected client count satisfaction INTEGER Device satisfaction score tx_bytes_r REAL Transmit rate (bytes/sec) rx_bytes_r REAL Receive rate (bytes/sec) site TEXT Site identifier"},{"location":"architecture/#clients","title":"clients","text":"Column Type Description ts REAL Unix timestamp mac TEXT Client MAC address hostname TEXT Client hostname ip TEXT Client IP is_wired INTEGER 1 = wired, 0 = wireless ssid TEXT Connected SSID signal_dbm INTEGER Signal strength in dBm satisfaction INTEGER Client satisfaction score channel INTEGER Radio channel radio TEXT Radio band (e.g., <code>na</code>, <code>ng</code>) tx_bytes REAL Transmit bytes rx_bytes REAL Receive bytes tx_rate REAL Transmit rate (Mbps) rx_rate REAL Receive rate (Mbps) site TEXT Site identifier"},{"location":"architecture/#netflow","title":"netflow","text":"Column Type Description ts REAL Unix timestamp src_ip TEXT Source IP address dst_ip TEXT Destination IP address src_port INTEGER Source port dst_port INTEGER Destination port protocol INTEGER IP protocol number bytes INTEGER Total bytes in flow packets INTEGER Total packets in flow site TEXT Site identifier"},{"location":"architecture/#alarms","title":"alarms","text":"Column Type Description ts REAL Unix timestamp alarm_id TEXT UniFi alarm ID type TEXT Alarm type string message TEXT Alarm message device_name TEXT Originating device archived INTEGER 1 = archived site TEXT Site identifier"},{"location":"architecture/#design-decisions","title":"Design Decisions","text":"<ul> <li>SQLite over InfluxDB/Prometheus: Single-network monitoring doesn't need time-series database overhead. SQLite WAL mode handles concurrent reads/writes.</li> <li>No config files: Environment variables only, Docker-native.</li> <li>Custom IPFIX parser: UCG-Max sends mixed template/data packets in the same UDP datagram. The standard <code>netflow</code> library can't handle this -- the custom parser processes set-by-set.</li> <li>Session reuse: Single <code>UnifiClient</code> instance, re-auth only on 401 to avoid rate limiting.</li> <li>In-memory WebSocket: Single-process, no Redis/pub-sub needed.</li> <li>Weighted health score: WAN status (40%) + device health (30%) + alarm severity (30%).</li> </ul>"},{"location":"configuration/","title":"Configuration","text":"<p>All settings are configured via environment variables. Use a <code>.env</code> file or pass them directly in <code>docker-compose.yml</code>.</p>"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":""},{"location":"configuration/#unifi-gateway","title":"UniFi Gateway","text":"Variable Default Description <code>UNIFI_HOST</code> <code>192.168.1.1</code> Gateway IP or hostname <code>UNIFI_USERNAME</code> <code>admin</code> Local admin username <code>UNIFI_PASSWORD</code> (required) Local admin password <code>UNIFI_SITE</code> <code>default</code> UniFi site name (single site) <code>UNIFI_SITES</code> (empty) Comma-separated site names for multi-site (overrides <code>UNIFI_SITE</code>) <code>UNIFI_PORT</code> <code>443</code> Gateway HTTPS port"},{"location":"configuration/#web-dashboard","title":"Web Dashboard","text":"Variable Default Description <code>WEB_HOST</code> <code>0.0.0.0</code> Dashboard bind address <code>WEB_PORT</code> <code>8080</code> Dashboard port"},{"location":"configuration/#authentication","title":"Authentication","text":"Variable Default Description <code>AUTH_USERNAME</code> (empty) HTTP Basic Auth username (both required to enable) <code>AUTH_PASSWORD</code> (empty) HTTP Basic Auth password <p>When both <code>AUTH_USERNAME</code> and <code>AUTH_PASSWORD</code> are set, all endpoints require HTTP Basic Auth except <code>/api/health</code> (bypassed for Docker healthchecks).</p> <p>WebSocket authentication uses an hour-based SHA-256 token from <code>GET /api/auth/token</code>.</p>"},{"location":"configuration/#netflowipfix","title":"NetFlow/IPFIX","text":"Variable Default Description <code>NETFLOW_ENABLED</code> <code>true</code> Enable NetFlow/IPFIX collector <code>NETFLOW_HOST</code> <code>0.0.0.0</code> NetFlow listener bind address <code>NETFLOW_PORT</code> <code>2055</code> NetFlow listener port"},{"location":"configuration/#data","title":"Data","text":"Variable Default Description <code>POLL_INTERVAL</code> <code>30</code> Seconds between API polls (min 5) <code>RETENTION_HOURS</code> <code>168</code> Data retention in hours (default 7 days, min 1) <code>DB_PATH</code> <code>data/monitor.db</code> SQLite database path"},{"location":"configuration/#alerts","title":"Alerts","text":"Variable Default Description <code>ALERT_WEBHOOK_URL</code> (empty) Webhook URL for alert notifications (empty = disabled) <code>ALERT_COOLDOWN</code> <code>300</code> Seconds between repeated alerts per rule (min 30)"},{"location":"configuration/#envexample","title":".env.example","text":"<pre><code># UniFi Gateway\nUNIFI_HOST=192.168.1.1\nUNIFI_USERNAME=admin\nUNIFI_PASSWORD=your_password_here\nUNIFI_SITE=default\n# UNIFI_SITES=default,office    # Multi-site (overrides UNIFI_SITE)\nUNIFI_PORT=443\n\n# Web Dashboard\nWEB_HOST=0.0.0.0\nWEB_PORT=8080\n\n# Authentication (both required to enable)\nAUTH_USERNAME=\nAUTH_PASSWORD=\n\n# NetFlow/IPFIX Collector\nNETFLOW_ENABLED=true\nNETFLOW_HOST=0.0.0.0\nNETFLOW_PORT=2055\n\n# Data\nPOLL_INTERVAL=30\nRETENTION_HOURS=168\nDB_PATH=data/monitor.db\n\n# Alerts\nALERT_WEBHOOK_URL=\nALERT_COOLDOWN=300\n</code></pre>"},{"location":"configuration/#multi-site-setup","title":"Multi-Site Setup","text":"<p>To monitor multiple UniFi sites:</p> <ol> <li>Set <code>UNIFI_SITES</code> to a comma-separated list of site names:    <pre><code>UNIFI_SITES=default,office,warehouse\n</code></pre></li> <li>The poller queries each site independently per cycle</li> <li>All data is tagged with the <code>site</code> column in SQLite</li> <li>The dashboard shows a site selector dropdown</li> <li>API endpoints accept an optional <code>?site=</code> query parameter</li> </ol> <p><code>UNIFI_SITES</code> overrides <code>UNIFI_SITE</code> when set. If neither is set, defaults to <code>default</code>.</p>"},{"location":"configuration/#validation","title":"Validation","text":"<p>All numeric values have bounds checking:</p> <ul> <li><code>POLL_INTERVAL</code>: minimum 5 seconds</li> <li><code>RETENTION_HOURS</code>: minimum 1 hour</li> <li><code>ALERT_COOLDOWN</code>: minimum 30 seconds</li> <li><code>UNIFI_PORT</code>: 1-65535</li> </ul> <p>Invalid values log a warning and fall back to defaults.</p>"},{"location":"deployment/","title":"Deployment","text":""},{"location":"deployment/#docker-compose-recommended","title":"Docker Compose (recommended)","text":"<pre><code>git clone https://github.com/Matt-Bloise/unifi-monitor.git\ncd unifi-monitor\ncp .env.example .env\n# Edit .env with your gateway credentials\ndocker compose up -d\n</code></pre>"},{"location":"deployment/#docker-composeyml","title":"docker-compose.yml","text":"<pre><code>services:\n  monitor:\n    build: .\n    ports:\n      - \"${WEB_PORT:-8080}:8080\"\n      - \"${NETFLOW_PORT:-2055}:2055/udp\"\n    volumes:\n      - monitor-data:/app/data\n    env_file:\n      - .env\n    restart: unless-stopped\n    deploy:\n      resources:\n        limits:\n          memory: 256M\n    logging:\n      driver: json-file\n      options:\n        max-size: \"10m\"\n        max-file: \"3\"\n\nvolumes:\n  monitor-data:\n</code></pre> <p>Key points:</p> <ul> <li>Port 8080: Web dashboard and REST API</li> <li>Port 2055/udp: NetFlow/IPFIX collector</li> <li>Volume <code>monitor-data</code>: Persists SQLite database across container restarts</li> <li>256M memory limit: Sufficient for single-network monitoring</li> <li>Log rotation: 3 files at 10MB each</li> </ul>"},{"location":"deployment/#dockerfile","title":"Dockerfile","text":"<p>Multi-stage build based on <code>python:3.12-slim</code>:</p> <ol> <li>Builder stage: Installs Python dependencies (including optional <code>netflow</code>)</li> <li>Runtime stage: Copies installed packages, runs as non-root <code>monitor</code> user</li> <li>Healthcheck: Queries <code>/api/health</code> every 30 seconds</li> </ol>"},{"location":"deployment/#rebuild","title":"Rebuild","text":"<p>After code changes:</p> <pre><code>docker compose up -d --build\n</code></pre>"},{"location":"deployment/#view-logs","title":"View logs","text":"<pre><code>docker compose logs -f monitor\n</code></pre>"},{"location":"deployment/#local-development","title":"Local Development","text":"<pre><code>pip install -e \".[dev,netflow]\"\ncp .env.example .env\n# Edit .env\npython -m unifi_monitor\n</code></pre> <p>The dashboard is available at <code>http://localhost:8080</code>.</p>"},{"location":"deployment/#systemd","title":"Systemd","text":"<p>For running directly on a Linux host:</p> <pre><code>[Unit]\nDescription=UniFi Monitor\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=simple\nExecStart=/usr/bin/python3 -m unifi_monitor\nWorkingDirectory=/home/user/unifi-monitor\nEnvironmentFile=/home/user/unifi-monitor/.env\nRestart=on-failure\nRestartSec=10\n\n[Install]\nWantedBy=default.target\n</code></pre> <pre><code>systemctl --user daemon-reload\nsystemctl --user enable --now unifi-monitor\n</code></pre>"},{"location":"deployment/#reverse-proxy","title":"Reverse Proxy","text":""},{"location":"deployment/#nginx","title":"Nginx","text":"<pre><code>server {\n    listen 443 ssl;\n    server_name monitor.example.com;\n\n    location / {\n        proxy_pass http://127.0.0.1:8080;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n}\n</code></pre> <p>The <code>Upgrade</code> and <code>Connection</code> headers are required for WebSocket proxying.</p>"},{"location":"deployment/#caddy","title":"Caddy","text":"<pre><code>monitor.example.com {\n    reverse_proxy localhost:8080\n}\n</code></pre> <p>Caddy handles WebSocket upgrades automatically.</p>"},{"location":"deployment/#security","title":"Security","text":"<ul> <li>Set <code>AUTH_USERNAME</code> and <code>AUTH_PASSWORD</code> to enable HTTP Basic Auth</li> <li>Without auth, bind to <code>localhost</code> or place behind a reverse proxy</li> <li><code>/api/health</code> bypasses auth for Docker healthchecks</li> <li>WebSocket uses a separate hour-based token from <code>GET /api/auth/token</code></li> <li>The Docker container runs as a non-root user (<code>monitor</code>)</li> </ul>"},{"location":"deployment/#healthcheck","title":"Healthcheck","text":"<p>The built-in healthcheck queries <code>GET /api/health</code>:</p> <pre><code>curl -s http://localhost:8080/api/health\n# {\"status\":\"ok\",\"uptime_s\":3600.5,\"last_write_ts\":1234567890.123,\"db_size_bytes\":2310144}\n</code></pre> <p>Docker reports container health based on this endpoint (30s interval, 5s timeout).</p>"},{"location":"netflow/","title":"NetFlow / IPFIX","text":"<p>UniFi Monitor includes a built-in NetFlow/IPFIX collector that provides traffic visibility beyond what the UniFi API offers: top talkers, bandwidth over time, port/protocol breakdown, and DNS traffic analysis.</p>"},{"location":"netflow/#what-netflow-provides","title":"What NetFlow Provides","text":"<p>Without NetFlow, the dashboard shows client/device/WAN data from the UniFi API. With NetFlow enabled, you also get:</p> <ul> <li>Top talkers -- source and destination IPs ranked by bytes</li> <li>Top ports -- which ports/protocols consume the most bandwidth</li> <li>Bandwidth timeseries -- traffic volume over time with configurable bucket size</li> <li>DNS traffic analysis -- top DNS clients, top DNS servers, per-client-per-server query aggregates</li> </ul>"},{"location":"netflow/#gateway-setup","title":"Gateway Setup","text":"<p>Enable NetFlow/IPFIX on your UniFi gateway:</p> <ol> <li>UniFi Network UI &gt; Settings &gt; System &gt; NetFlow</li> <li>Server: IP address of the machine running UniFi Monitor</li> <li>Port: <code>2055</code> (default)</li> <li>Version: IPFIX (v10) is preferred; v5 and v9 are also supported</li> </ol> <p>The gateway will begin sending flow records as UDP datagrams to the configured address.</p>"},{"location":"netflow/#configuration","title":"Configuration","text":"Variable Default Description <code>NETFLOW_ENABLED</code> <code>true</code> Enable/disable the collector <code>NETFLOW_HOST</code> <code>0.0.0.0</code> Bind address for UDP listener <code>NETFLOW_PORT</code> <code>2055</code> UDP port for flow data <p>In Docker, port 2055/udp is exposed by default:</p> <pre><code>ports:\n  - \"${NETFLOW_PORT:-2055}:2055/udp\"\n</code></pre>"},{"location":"netflow/#protocol-support","title":"Protocol Support","text":"Protocol Version Support IPFIX v10 Full (recommended) NetFlow v9 Full NetFlow v5 Full"},{"location":"netflow/#ucg-max-quirk","title":"UCG-Max Quirk","text":"<p>The UCG-Max sends mixed template and data sets within a single UDP datagram. The standard <code>netflow</code> Python library cannot handle this. UniFi Monitor includes a custom set-by-set parser (<code>netflow/parser.py</code>) that processes each set independently, caching templates as they arrive.</p>"},{"location":"netflow/#data-pipeline","title":"Data Pipeline","text":"<pre><code>Gateway \u2500\u2500UDP\u2500\u2500&gt; Collector (port 2055)\n                    \u2502\n                    \u251c\u2500\u2500 Parse IPFIX/NetFlow sets\n                    \u251c\u2500\u2500 Extract: src_ip, dst_ip, src_port, dst_port, protocol, bytes, packets\n                    \u251c\u2500\u2500 Buffer in memory (thread-safe)\n                    \u2502\n                    \u2514\u2500\u2500 Batch write to SQLite every 10 seconds\n</code></pre>"},{"location":"netflow/#dns-traffic-analysis","title":"DNS Traffic Analysis","text":"<p>DNS queries are identified by destination port 53 (standard DNS) or 853 (DNS over TLS). The following endpoints aggregate DNS-related flow records:</p> Endpoint Description <code>GET /api/traffic/dns-queries</code> Per-client-per-server query aggregates <code>GET /api/traffic/dns-top-clients</code> Top DNS-querying clients by bytes <code>GET /api/traffic/dns-top-servers</code> Top DNS servers by bytes <p>This is useful for identifying which clients make the most DNS queries and which resolvers they use.</p>"},{"location":"netflow/#api-endpoints","title":"API Endpoints","text":"<p>All traffic endpoints accept <code>?hours=</code> and <code>?limit=</code> parameters.</p> Endpoint Default hours Default limit <code>/api/traffic/top-talkers</code> 1 20 <code>/api/traffic/top-destinations</code> 1 20 <code>/api/traffic/top-ports</code> 1 20 <code>/api/traffic/bandwidth</code> 24 N/A (bucketed) <code>/api/traffic/dns-queries</code> 1 100 <code>/api/traffic/dns-top-clients</code> 1 20 <code>/api/traffic/dns-top-servers</code> 1 20"},{"location":"netflow/#troubleshooting","title":"Troubleshooting","text":"<p>No traffic data showing up:</p> <ol> <li>Verify NetFlow is enabled on the gateway (UI &gt; Settings &gt; System &gt; NetFlow)</li> <li>Verify the server IP matches the machine running UniFi Monitor</li> <li>Check that port 2055/udp is not blocked by a firewall</li> <li>In Docker, ensure the UDP port is mapped: <code>2055:2055/udp</code></li> <li>Check logs for <code>NetFlow collector started</code> at startup</li> </ol> <p>Template errors:</p> <p>The first few packets after a gateway restart may be data-only (no templates). The parser discards these and waits for template sets to arrive. This is normal and resolves within a few seconds.</p>"}]}